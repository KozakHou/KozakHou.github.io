<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Parallel Computing, with applications in Quantitative Strategies | Kozak Hou </title> <meta name="author" content="Kozak Hou"> <meta name="description" content="Anastasia Papadopoulou, Kozak Hou, William Noh"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.9.0/main.min.css" rel="stylesheet"> <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.9.0/main.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.9.0/locales-all.min.js"></script> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/acm.png?b0d69408ee54d096702cdace5938cc5e"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://kozakhou.github.io/projects/parallel-computing-with-applications-in-quantitative-strategies/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Kozak</span> Hou </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">Projects <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/schedule/">Schedule </a> </li> <li class="nav-item "> <a class="nav-link" href="/CV/">CV </a> </li> <li class="nav-item "> <a class="nav-link" href="/people/">People </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Parallel Computing, with applications in Quantitative Strategies</h1> <p class="post-description">Anastasia Papadopoulou, Kozak Hou, William Noh</p> </header> <article> <p><br></p> <h1 id="parallel-computing-with-applications-in-quantitative-strategies">Parallel Computing, with applications in Quantitative Strategies</h1> <p>In the initial phase, we verify the installation of all required files. Following that, we conduct an in-depth analysis by applying multicore processing to a Volatility Momentum Equity Strategy. Finally, we conduct performance benchmarking using different numbers of CPU cores.</p> <p><br></p> <h3 id="installation-process">Installation Process</h3> <h4 id="ssh-to-your-cluster-as-student">SSH to your cluster as <code class="language-plaintext highlighter-rouge">student</code> </h4> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh student@hpcc-cluster-[]
</code></pre></div></div> <p>Download the max historical data csv files for AGG and SPY, along with the 60/40 python file from the me344 cluster. Here is the command to obtain them:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scp -r [sunetid]@me344.stanford.edu:/opt/ohpc/pub/me344/project-3 .
</code></pre></div></div> <p><strong>Data Collection and Preparation</strong>: Download daily data for the S&amp;P 500 companies from Yahoo Finance, specifically focusing on “High,” “Low,” and “Close” prices for the period spanning from 2013-01-01 to 2023-01-01. Perform data cleaning, excluding stocks listed after the start date to match our training period. Save the refined dataset as a CSV file.</p> <p><strong>Data Transfer to HPC Cluster</strong>: Copy the directory named “data” containing various files of historical equity data (obtained from the previous step) from your local computer to the HPC cluster. The destination path on the cluster should be “/home/student/data”. Alternatively, you may simply upload the files by browsing within Jupyter and slecting the “Upload” option.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scp -r data student@hpcc-cluster-1:
</code></pre></div></div> <p>Change to the project-3 directory</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd project-3
</code></pre></div></div> <p>The procedures are the same as the beginning of Project 3, except for “Install QSTrader and Jupyter as the student user” and there is no need to download the 60/40 python file.</p> <p>Install QSTrader, YFinance and Jupyter as the student user</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 -m venv backtest
source backtest/bin/activate
pip install --upgrade pip
pip install qstrader
pip install notebook==6.1.5
pip install jupyter_contrib_nbextensions
jupyter contrib nbextension install --user
pip install nglview
jupyter nbextension enable --py widgetsnbextension --user
jupyter nbextension enable nglview --py –user
pip install yfinance
pip install concurrent
pip install multiprocessing
pip install statistics
pip install pandas
pip install matplotlib
</code></pre></div></div> <p>Create a Slurm script to launch Jupyter Notebook on compute-1-1. Make you are in the <code class="language-plaintext highlighter-rouge">$HOME/project-3</code> directory (command to execute is <code class="language-plaintext highlighter-rouge">pwd</code>). Name the script <code class="language-plaintext highlighter-rouge">jupyter_submit.slurm</code>:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/bin/bash
#SBATCH --job-name="Jupyter"                # Job name
#SBATCH --mail-user=[sunetid]@stanford.edu  # Email address    
#SBATCH --mail-type=NONE                    # Mail notification type (NONE, BEGIN, END, FAIL, ALL)
#SBATCH --partition=normal                  # Node partition
#SBATCH --nodes=1                           # Number of nodes requested
#SBATCH --ntasks=1                          # Number of processes
#SBATCH --time=01:00:00                     # Time limit request

source ~/project-3/backtest/bin/activate
EXEC_DIR=$HOME/project-3
hostname &amp;&amp; jupyter-notebook --no-browser --notebook-dir=$EXEC_DIR
</code></pre></div></div> <p>Use the <code class="language-plaintext highlighter-rouge">sbatch</code> command to submit the jupyter script to Slurm (you used it in previous labs). Because you are running a Jupyter notebook, you need to collect the URL in order to connect via a web browser. Using the following command, you can obtain the URL from the Slurm job output file:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>egrep -w 'compute|localhost'  slurm-*.out
</code></pre></div></div> <p>The output will look something like this:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
slurm-103.out:compute-1-1
slurm-103.out:[I 18:40:29.846 NotebookApp] http://localhost:8888/?token=c11be5afa5cddd73548d8ff73786291202a37868d5c18451
slurm-103.out:        http://localhost:8888/?token=c11be5afa5cddd73548d8ff73786291202a37868d5c18451
</code></pre></div></div> <p>In the example the URL to copy is <code class="language-plaintext highlighter-rouge">http://localhost:8888/?token=c11be5afa5cddd73548d8ff73786291202a37868d5c18451</code>.</p> <p>You can’t directly access the URL being hosted on your cluster, so you need to use SSH local port forwarding:</p> <p>The following is an example of local port forwarding to interact with the Jupyter notebook hosted on compute-1-1 on your cluster (you are going to need to open a new terminal window to run this):</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh -L 8888:localhost:8888 student@hpcc-cluster-[C] -t ssh -L 8888:localhost:8888 compute-1-1
</code></pre></div></div> <p>Upon successful completion of the preceding command your prompt will show that you’re on compute-1-1 as the student user. You can now enter the URL we noted earlier into your computer’s web browser, launching a Juypter Notebook.</p> <p>Note that due to the inability to establish an external network connection from the Stanford-HPCC computing node, the data source needs to be downloaded as a CSV format from localhost and then uploaded. In the submitted code report, instructions on how to download data using the yfinance API are provided.</p> <p>Additionally, write a program to perform Monte Carlo backtesting and name it MCtask.py.</p> <p>P.S. You can use the “Upload” button at the upper right corner of the Jupyter Notebook’s homepage to upload data from localhost to your assigned cluster.</p> <p>MCtask.py</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">math</span>
<span class="kn">import</span> <span class="n">statistics</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>

<span class="k">def</span> <span class="nf">convertToRank</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
    <span class="c1">#print (lst)
</span>    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">arr</span><span class="p">.</span><span class="nf">argsort</span><span class="p">()</span>
    <span class="n">ranks</span> <span class="o">=</span> <span class="n">order</span><span class="p">.</span><span class="nf">argsort</span><span class="p">()</span>
    <span class="c1">#print ("RANK: ", ranks)
</span>    <span class="k">return</span> <span class="n">ranks</span>

<span class="k">def</span> <span class="nf">allocation</span><span class="p">(</span><span class="n">pvr</span><span class="p">,</span> <span class="n">hvr</span><span class="p">,</span> <span class="n">prr</span><span class="p">):</span>
    <span class="n">pvr</span> <span class="o">=</span> <span class="nf">convertToRank</span><span class="p">(</span><span class="n">pvr</span><span class="p">)</span>
    <span class="n">hvr</span> <span class="o">=</span> <span class="nf">convertToRank</span><span class="p">(</span><span class="n">hvr</span><span class="p">)</span>
    <span class="n">prr</span> <span class="o">=</span> <span class="nf">convertToRank</span><span class="p">(</span><span class="n">prr</span><span class="p">)</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="p">(</span><span class="n">pvr</span><span class="o">+</span><span class="n">hvr</span><span class="p">)</span><span class="o">*</span><span class="n">prr</span>
    <span class="c1">#print (pvr)
</span>    <span class="c1">#print (hvr)
</span>    <span class="c1">#print (prr)
</span>    <span class="c1">#print (weights)
</span>    <span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span> <span class="o">/</span> <span class="nf">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">weights</span>
    
<span class="k">def</span> <span class="nf">MCbacktest</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="n">closeData</span><span class="p">,</span> <span class="n">highData</span><span class="p">,</span> <span class="n">lowData</span><span class="p">,</span> <span class="n">thisCore</span><span class="p">,</span> <span class="n">totalCore</span> <span class="o">=</span> <span class="n">args</span>
    <span class="n">initial</span><span class="o">=</span><span class="mi">100000</span>
    <span class="n">dateResult</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">returnResult</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">121</span><span class="o">+</span><span class="p">(</span><span class="n">thisCore</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">2414</span><span class="o">//</span><span class="n">totalCore</span><span class="p">,</span> <span class="mi">121</span><span class="o">+</span><span class="p">(</span><span class="n">thisCore</span><span class="p">)</span><span class="o">*</span><span class="mi">2414</span><span class="o">//</span><span class="n">totalCore</span><span class="p">):</span> <span class="c1">#2535
</span>        <span class="c1"># 121~321, ~ , 2321~2521
</span>        <span class="n">parkVolatility</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">40</span>
        <span class="n">histVolatility</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">40</span>
        <span class="n">prices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">40</span>
        <span class="k">for</span> <span class="n">stock</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">40</span><span class="p">):</span>
            <span class="n">prices</span><span class="p">[</span><span class="n">stock</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">closeData</span><span class="p">[</span><span class="nf">str</span><span class="p">(</span><span class="n">stock</span><span class="p">)][</span><span class="n">i</span><span class="p">])</span>
            <span class="n">pSum</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">hArray</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">120</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
                <span class="n">pSum</span> <span class="o">+=</span> <span class="p">(</span><span class="n">math</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">highData</span><span class="p">[</span><span class="nf">str</span><span class="p">(</span><span class="n">stock</span><span class="p">)][</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="n">lowData</span><span class="p">[</span><span class="nf">str</span><span class="p">(</span><span class="n">stock</span><span class="p">)][</span><span class="n">j</span><span class="p">]))</span><span class="o">**</span><span class="mi">2</span>
                <span class="n">hArray</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">math</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">closeData</span><span class="p">[</span><span class="nf">str</span><span class="p">(</span><span class="n">stock</span><span class="p">)][</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="n">closeData</span><span class="p">[</span><span class="nf">str</span><span class="p">(</span><span class="n">stock</span><span class="p">)][</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">parkVolatility</span><span class="p">[</span><span class="n">stock</span><span class="p">]</span> <span class="o">=</span> <span class="n">math</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">pSum</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="mi">120</span><span class="o">*</span><span class="n">math</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
            <span class="n">histVolatility</span><span class="p">[</span><span class="n">stock</span><span class="p">]</span> <span class="o">=</span> <span class="n">statistics</span><span class="p">.</span><span class="nf">stdev</span><span class="p">(</span><span class="n">hArray</span><span class="p">)</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="nf">allocation</span><span class="p">(</span><span class="n">parkVolatility</span><span class="p">,</span> <span class="n">histVolatility</span><span class="p">,</span> <span class="n">prices</span><span class="p">)</span>
        <span class="c1">#print (weights)
</span>        <span class="n">nextday</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">stock</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">40</span><span class="p">):</span>
            <span class="n">nextday</span> <span class="o">+=</span> <span class="n">initial</span> <span class="o">*</span> <span class="n">weights</span><span class="p">[</span><span class="n">stock</span><span class="p">]</span> <span class="o">*</span> <span class="n">closeData</span><span class="p">[</span><span class="nf">str</span><span class="p">(</span><span class="n">stock</span><span class="p">)][</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">closeData</span><span class="p">[</span><span class="nf">str</span><span class="p">(</span><span class="n">stock</span><span class="p">)][</span><span class="n">i</span><span class="p">]</span>
        <span class="n">dateResult</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">closeData</span><span class="p">.</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">returnResult</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">nextday</span><span class="o">/</span><span class="n">initial</span><span class="p">)</span>
        <span class="n">initial</span> <span class="o">=</span> <span class="n">nextday</span>
    <span class="k">return</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">({</span><span class="sh">"</span><span class="s">Date</span><span class="sh">"</span><span class="p">:</span><span class="n">dateResult</span><span class="p">,</span> <span class="sh">"</span><span class="s">Equity</span><span class="sh">"</span><span class="p">:</span><span class="n">returnResult</span><span class="p">})</span>

<span class="n">Create</span> <span class="n">a</span> <span class="n">new</span> <span class="n">Python</span> <span class="mi">3</span> <span class="n">notebook</span> <span class="ow">and</span> <span class="n">navigate</span> <span class="n">to</span> <span class="n">it</span><span class="p">.</span>
<span class="n">Main</span> <span class="n">File</span>
<span class="kn">import</span> <span class="n">yfinance</span> <span class="k">as</span> <span class="n">yf</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">json</span>
<span class="kn">import</span> <span class="n">math</span>
<span class="kn">import</span> <span class="n">statistics</span>
<span class="kn">from</span> <span class="n">qstrader.statistics.tearsheet</span> <span class="kn">import</span> <span class="n">TearsheetStatistics</span>
<span class="kn">from</span> <span class="n">concurrent.futures</span> <span class="kn">import</span> <span class="n">ProcessPoolExecutor</span>
<span class="kn">import</span> <span class="n">time</span>
<span class="kn">from</span> <span class="n">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>
<span class="kn">from</span> <span class="n">itertools</span> <span class="kn">import</span> <span class="n">repeat</span>
<span class="kn">import</span> <span class="n">MCtask</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sd='2013-01-01'
ed='2023-01-31'
stocks = ["AAPL", "MSFT", "GOOG", "GOOGL", "AMZN", "PCAR", "BRK-A", "NVDA", "BRK-B", "TSLA", "META", "TSM", "V", "XOM", "UNH", "JNJ", "WMT", "JPM", "NVO", "PG", "MA", "LLY", "CVX", "HD", "ABBV", "MRK", "KO", "AVGO", "ASML", "ORCL", "PEP", "PFE", "BAC", "TMO", "COST", "AZN", "CSCO", "SHEL", "MCD", "CRM", "NVS", "TM", "NKE", "DIS"]
# Rank 30 Alibaba (BABA) is removed. (data starts from 2015) 
print (len(stocks))
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">getData</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">40</span><span class="p">):</span> <span class="c1"># key = High, Low, Close
</span>    <span class="k">if</span> <span class="n">n</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span> <span class="k">return</span> <span class="sh">"</span><span class="s">ERROR_1</span><span class="sh">"</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">yf</span><span class="p">.</span><span class="nf">download</span><span class="p">(</span><span class="n">stocks</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sd</span><span class="p">,</span> <span class="n">ed</span><span class="p">)[</span><span class="n">key</span><span class="p">]).</span><span class="nf">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">Date</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">Date</span><span class="sh">"</span><span class="p">,</span><span class="n">key</span><span class="p">:</span><span class="nf">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)})</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">yf</span><span class="p">.</span><span class="nf">download</span><span class="p">(</span><span class="n">stocks</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">sd</span><span class="p">,</span> <span class="n">ed</span><span class="p">)[</span><span class="n">key</span><span class="p">]).</span><span class="nf">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">Data</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">Date</span><span class="sh">"</span><span class="p">,</span><span class="n">key</span><span class="p">:</span><span class="nf">str</span><span class="p">(</span><span class="n">i</span><span class="p">)})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">concat</span><span class="p">([</span><span class="n">result</span><span class="p">,</span> <span class="n">temp</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># highData = getData("High")
# lowData = getData("Low")
# closeData = getData("Close")
</span>
<span class="c1"># highData.to_csv('highData.csv')
# lowData.to_csv('lowData.csv')
# closeData.to_csv('closeData.csv')
</span>
<span class="c1">#------------------------------------------------------------------------------------------#
# Since the computing node cannot access to external internet through yfinance's API
# We download highData, lowData, and closeData at localhost then upload to hpcc-cluser
</span>
<span class="n">highData</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">'</span><span class="s">highData.csv</span><span class="sh">'</span><span class="p">)</span>
<span class="n">lowData</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">'</span><span class="s">lowData.csv</span><span class="sh">'</span><span class="p">)</span>
<span class="n">closeData</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">'</span><span class="s">closeData.csv</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># transform Date's data type to datetime type 
</span><span class="n">highData</span><span class="p">[</span><span class="sh">'</span><span class="s">Date</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">to_datetime</span><span class="p">(</span><span class="n">highData</span><span class="p">[</span><span class="sh">'</span><span class="s">Date</span><span class="sh">'</span><span class="p">])</span>
<span class="n">lowData</span><span class="p">[</span><span class="sh">'</span><span class="s">Date</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">to_datetime</span><span class="p">(</span><span class="n">lowData</span><span class="p">[</span><span class="sh">'</span><span class="s">Date</span><span class="sh">'</span><span class="p">])</span>
<span class="n">closeData</span><span class="p">[</span><span class="sh">'</span><span class="s">Date</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">to_datetime</span><span class="p">(</span><span class="n">closeData</span><span class="p">[</span><span class="sh">'</span><span class="s">Date</span><span class="sh">'</span><span class="p">])</span>

<span class="c1"># transform the Date column to index
</span><span class="n">highData</span><span class="p">.</span><span class="nf">set_index</span><span class="p">(</span><span class="sh">'</span><span class="s">Date</span><span class="sh">'</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">lowData</span><span class="p">.</span><span class="nf">set_index</span><span class="p">(</span><span class="sh">'</span><span class="s">Date</span><span class="sh">'</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">closeData</span><span class="p">.</span><span class="nf">set_index</span><span class="p">(</span><span class="sh">'</span><span class="s">Date</span><span class="sh">'</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">len</span><span class="p">(</span><span class="n">highData</span><span class="p">),</span> <span class="nf">len</span><span class="p">(</span><span class="n">lowData</span><span class="p">),</span> <span class="nf">len</span><span class="p">(</span><span class="n">closeData</span><span class="p">)</span>
<span class="c1"># The output should be: (2537, 2537, 2537) 
</span></code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span>
<span class="n">max_cores</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="nf">cpu_count</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span>  <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span> 
    <span class="c1">################# CHANGE CORES HERE #################
</span>    <span class="n">num_cores</span> <span class="o">=</span> <span class="n">max_cores</span>
    <span class="c1">################# CHANGE CORES HERE #################
</span>    
    <span class="n">core_num</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="n">max_cores</span><span class="p">]</span>
    <span class="n">time_taken</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">num_cores</span> <span class="ow">in</span> <span class="n">core_num</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        <span class="k">with</span> <span class="nc">Pool</span><span class="p">(</span><span class="n">processes</span> <span class="o">=</span> <span class="n">num_cores</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
            <span class="n">BTresult</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="n">MCtask</span><span class="p">.</span><span class="n">MCbacktest</span><span class="p">,</span> <span class="p">[(</span><span class="n">closeData</span><span class="p">,</span> <span class="n">highData</span><span class="p">,</span> <span class="n">lowData</span><span class="p">,</span> <span class="n">core</span><span class="p">,</span> <span class="n">num_cores</span><span class="p">)</span> <span class="k">for</span> <span class="n">core</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_cores</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        <span class="n">time_taken</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">UTILIZING </span><span class="si">{</span><span class="n">num_cores</span><span class="si">}</span><span class="s"> CORE(S) : TOOK </span><span class="si">{</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="si">:</span><span class="p">.</span><span class="mi">5</span><span class="n">f</span><span class="si">}</span><span class="s"> SEC</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="p">.</span><span class="nf">bar</span><span class="p">(</span><span class="n">core_num</span><span class="p">,</span> <span class="n">time_taken</span><span class="p">)</span> 
        <span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Number of Cores</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Time Taken (sec)</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">Time Taken vs Number of Cores</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">BackTestResult</span> <span class="o">=</span> <span class="n">BTresult</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">BTresult</span><span class="p">)):</span>
    <span class="n">BackTestResult</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">concat</span><span class="p">([</span><span class="n">BackTestResult</span><span class="p">,</span> <span class="n">BTresult</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
<span class="n">FinalResult</span> <span class="o">=</span> <span class="n">BackTestResult</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
<span class="n">FinalResult</span> <span class="o">=</span> <span class="n">FinalResult</span><span class="p">.</span><span class="nf">set_index</span><span class="p">(</span><span class="sh">"</span><span class="s">Date</span><span class="sh">"</span><span class="p">)</span>
<span class="n">initial</span> <span class="o">=</span> <span class="mi">1000000</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">FinalResult</span><span class="p">)):</span>
    <span class="n">new</span> <span class="o">=</span> <span class="n">initial</span> <span class="o">*</span> <span class="n">FinalResult</span><span class="p">[</span><span class="sh">"</span><span class="s">Equity</span><span class="sh">"</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
    <span class="n">FinalResult</span><span class="p">[</span><span class="sh">"</span><span class="s">Equity</span><span class="sh">"</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">new</span>
    <span class="n">initial</span> <span class="o">=</span> <span class="n">new</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tearsheet</span> <span class="o">=</span> <span class="nc">TearsheetStatistics</span><span class="p">(</span><span class="n">strategy_equity</span><span class="o">=</span><span class="n">FinalResult</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sh">'</span><span class="s">volatilityMomentum Alpha Strategy</span><span class="sh">'</span><span class="p">)</span>
<span class="n">tearsheet</span><span class="p">.</span><span class="nf">plot_results</span><span class="p">()</span>
</code></pre></div></div> <div class="row justify-content-sm-center"> <div class="col-sm-10 mt-5 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/hpccc-480.webp 480w,/assets/img/hpccc-800.webp 800w,/assets/img/hpccc-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/hpccc.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>In this way, we have implemented Parallel Computing for the Volatility Momentum Equity Strategy and conducted benchamrking analysis for varying numbers of CPU cores.</p> <h4 id="terminating-jupyter"><strong>Terminating Jupyter</strong></h4> <p>To stop local port forwarding on your computer, go to the terminal window where you entered the command enter <code class="language-plaintext highlighter-rouge">exit</code> a few times to end all sessions.</p> <p>To stop the Jupyter instance from running, run <code class="language-plaintext highlighter-rouge">squeue</code> on the cluster to see the jobs running. You will see output resembling this:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
105    normal  Jupyter  [user]  R       7:08      1 compute-1-1
</code></pre></div></div> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Kozak Hou. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?b7816bd189846d29eded8745f9c4cf77"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.min.js" integrity="sha256-rjmgmaB99riUNcdlrDtcAiwtLIojSxNyUFdl+Qh+rB4=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> <script src="/assets/js/shortcut-key.js"></script> </body> </html>